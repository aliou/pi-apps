services:
  relay:
    build: .
    image: ghcr.io/aliou/pi-relay
    ports:
      - "31415:31415"
    volumes:
      # Docker socket for managing sandbox containers
      - /var/run/docker.sock:/var/run/docker.sock
      # Bind mounts with identical host/container paths. The relay passes
      # these paths to Docker when creating sandbox containers, and Docker
      # resolves them on the host. They must match on both sides.
      - /opt/pi-relay/data:/opt/pi-relay/data
      - /opt/pi-relay/config:/opt/pi-relay/config
      - /opt/pi-relay/state:/opt/pi-relay/state
      - /opt/pi-relay/cache:/opt/pi-relay/cache
    environment:
      PI_RELAY_DATA_DIR: /opt/pi-relay/data
      PI_RELAY_CONFIG_DIR: /opt/pi-relay/config
      PI_RELAY_STATE_DIR: /opt/pi-relay/state
      PI_RELAY_CACHE_DIR: /opt/pi-relay/cache
    restart: unless-stopped
